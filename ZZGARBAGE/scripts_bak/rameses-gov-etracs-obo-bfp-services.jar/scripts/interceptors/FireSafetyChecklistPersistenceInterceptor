import com.rameses.annotations.*; 

class FireSafetyChecklistPersistenceInterceptor {
	
	@DataContext("fire_safety_checklist")
	def checkListEm;

	//after opening the evaluation
	@After(pattern="PersistenceService.read", eval="#{ args[0]._schemaname == 'vw_building_evaluation' && result.typeid?.toLowerCase() == 'fsec'}", index=100)
	public void afterOpenEvaluation(def evt) {
		def p = evt.args[0];
		def a = evt.result;

		def chk = checkListEm.find( [appid: a.appid ] ).first();
		if( chk ) {
			a.firesafetychecklist = chk;
		}
	}
	

}