
<%
	def svc = SERVICE.lookup("OnlineBuildingPermitService", "obo");
	def items = svc.getItems( [type: 'ACCESSORIES'] );
	def grps = items.groupBy{ it.category };
%>

<script>
	\$put("item", new function() {
		var self = this;

		this.map = {};
		<%items.each{ i-> %>
		this.map.${ i.objid.toLowerCase() } = { objid: "${i.objid}", checked: false, caption: "${i.caption}", datatype:"${i.datatype}", unit:"${i.unit}" };<%}%>

		//load accessories
		var app = \$get("app").code;	

		for(var i = 0; i < app.accessories.length; i++) {
			var p = app.accessories[ i ];
			var id = p.objid.toLowerCase();
			//console.log( this.map[ id ] );
			this.map[ id ].checked = true;
			this.map[ id ].value = p.value; 
		};

		this.addItems = function() {
			app.accessories = [];
			for( var prop in this.map ) {
				if( this.map[prop].checked == true ) {
					app.accessories.push( this.map[prop] );
				}
			}
			app.navigate("confirm");
		}

	});
	alert('ok');
</script>
<br>
<br>
<legend>Add Accessories</legend>

<div>
	<%grps.each{ g,v->%>
		<br>
		<h2>${g}</h2>
	 	<%v.each { i->%>
	 		<div>
			 		&nbsp;&nbsp;<input type="checkbox" r:context="item" r:name="map.${ i.objid.toLowerCase() }.checked">&nbsp;${i.caption}
			 		<input type="text" r:context="item" r:name="map.${ i.objid.toLowerCase() }.value"
			 			r:datatype="${i.datatype}"
			 			r:depends="map.${ i.objid.toLowerCase() }.checked" 
			 			r:visibleWhen="#{map.${ i.objid.toLowerCase() }.checked == true}"
			 			style="width:80px;background-color:lightyellow;">
			 		<label r:context="item"
			 			r:depends="map.${ i.objid.toLowerCase() }.checked"  
			 			r:visibleWhen="#{map.${ i.objid.toLowerCase() }.checked == true}">&nbsp;&nbsp;${i.unit}</label>	
 			</div> 
	 	<%}%>
	<%}%>
 	
	<br><br>
	<button r:context="app" r:name="_appinfo" class="btn btn-submit btn-primary"><i class="fa fa-angle-double-left"></i> Back</button>
	<button r:context="item" r:name="addItems" class="btn btn-submit btn-primary">Next <i class="fa fa-angle-double-right"></i></button>
</div>	 
