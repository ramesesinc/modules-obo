
<script>
	\$register( {id:'askrefno', page:"${PAGE.path}/askrefno", context: 'askrefno' } );
	\$register( {id:'viewbill', page:"${PAGE.path}/viewbill", context: 'viewbill' } );

	\$put( "billing", new function() {

		var self = this;

		this.error;
		this.orgcode = "${PARAMS.info.id}";
		this.bill;
		this.payorderdetails;
		this.lgu = {title:"${PARAMS.info.title}", group: "${PARAMS.info.group.title}"};
		this.service;

		this.loadBill = function( params, handler ) {
			self.service.getBilling( params, function(o,s) {
				if( s == "error" ) {
					self.error = o.result;
					self._controller.refresh();
				}
				else {
					self.error = null;
					self._controller.refresh();	
					self.payorderdetails = o.result;
					self.bill = o.result.info;
					self.bill.amount = o.result.amount;
					handler();
				}
			});
		}

		this.onload = function() {
			this.service = Service.lookup(this.orgcode + ":OboBillingService");
			var hash = window.location.hash;
			if( !hash ) {
				window.location.hash = "askrefno";
			}
		}


	})
</script>

<h1>Building Permit Online Billing</h1>

<div r:context="billing" r:visibleWhen="#{error!=null}">
  <label r:context="billing" style="color:red;">#{error}</label>
</div>

<div id="content"></div>
