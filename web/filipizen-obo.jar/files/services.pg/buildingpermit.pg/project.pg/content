
<style>
  .caption-class { width:250px; }
  .input-class { width:300px;}
  .w700 { width:700px }
  .w100 { width:100px }

</style>

<%
  def svc = SERVICE.lookup("OboMiscListService", "obo");
  def workTypes = svc.getWorkTypes();
%>

<script>
  \$put("project", new function() {
      var self = this;
      this.error;
      this.mode;

      var listSvc = Service.lookup("OboMiscListService", "obo");
      var svc = Service.lookup("OnlineBuildingApplicationService", "obo");
      var app = \$get("app").code;

      this.project;

      this.occupancytypes = listSvc.getOccupancyTypes();
      this.bldgTypes;

      this.propertyChangeListener = {
        "project.occupancytypeid" : function(o){
          if(self.project.occupancytypeid == null ) {
            self.bldgTypes = [];
          }
          else {
            self.bldgTypes = listSvc.getBldgTypes( {type: self.project.occupancytypeid } );
          }  
        }
      }

      this.updateProject = function() {
        this.project.appid = app.appid;
        svc.updateProjectInfo( this.project );
        app.moveNextStep();
      }

      this.onload = function() {
        this.project = svc.getProjectInfo( {appid: app.appid });
        for(var i = 0; i < this.project.worktypes.length; i++) {
          var p = this.project.worktypes[ i ];
          this.worktypes[ p.toLowerCase() ].checked = true;
        };        
        app.updateStepNavbar();
      }

      this.bldgTypes = [];

  });
</script>


  <legend>Project Details</legend>
  <div r:context="project" r:visibleWhen="#{error != null }">
     <label r:context="project" style="color:red;">#{error}</label>
  </div>

  <div class="form">
    @wx:text(caption:'Project Title', context:'project', name:'project.title', required: true, hint:'Enter Project Title', inputClass: '+w700')
    @wx:text(caption:'Project Description', context:'project', name:'project.description', required: true, hint:'Enter Project Description', inputClass: '+w700')
    @wx:combo(caption:'Primary Occupancy Type', context:'project', name:'project.occupancytypeid', inputClass: '+w700', required:true,
    attrs:[allowNull:true, emptyText:'-', items:'occupancytypes', itemLabel:'description', itemKey:'objid']  )

    @wx:combo(caption:'Bldg Type', context:'project', name:'project.bldgtypeid', inputClass: '+w700', required:true,
      attrs:[allowNull:true, emptyText:'-', items:'bldgTypes',itemLabel:'title', itemKey:'objid', depends: 'project.occupancytypeid' ]  )
    
    @wx:integer(caption:'No of Units', context:'project', name:'project.numunits', required: true, inputClass:'+w100')
    @wx:decimal(caption:'Total Floor Area [sq.meter]', context:'project', name:'project.totalfloorarea', required: true, inputClass:'+w100')
    @wx:decimal(caption:'Building Height [meter]', context:'project', name:'project.height', required: true, inputClass:'+w100')
    @wx:decimal(caption:'Estimated Cost [Php]', context:'project', name:'project.estimatedcost', required: true, inputClass:'+w200')
    @wx:date(caption:'Proposed Construction Date', context:'project', name:'project.dtproposedconstruction', required: true)
    @wx:date(caption:'Expected Completion Date', context:'project', name:'project.dtproposedconstruction', required: true)
  </div>
  @wx:button( caption: 'Next', context:'project', name: 'updateProject' )



