<script>
	\$register( {
		id:"facilities", 
		context: "facilities", 
		page: "/partners/${PARAMS.name}/services/buildingpermit/buildingapplication/facilities", 
		title:"Select Facilities" 
	} );


	var controller = new function() {
		var self = this;
		var svc = Service.lookup("CacheService", "default");
		var oboSvc = Service.lookup("TestOboService", "default");
		this.code;
		this.ctcno;
		this.trackingno;
		this.sections;
		this.selectedItem;
		this.bldgpermit;


		this.onload = function() {
	        self.ctc = svc.get( "${PARAMS.ctcno}" );
	        self.trackingno = svc.get( "${PARAMS.ctcno}_trackingno" );
			self.code = "${PARAMS.code}";
			if (!self.code) self.code = "architectural";

			//self.bldgpermit = 

			self.sections = oboSvc.getSectionCategory({section: self.code.toUpperCase()});
			if (!self.sections) self.sections = [];

			if (self.sectionListModel) self.sectionListModel.rows = self.sections.length;


			return self.code;
		}

		this.onpageload = function( page ) {
			var controller = \$get( page );
			if (controller && controller.code.onload) {
				controller.code.onload();
			}
		}

		this.beforepageload = function( page, params ) {
			if (!params.name) params.name = "${PARAMS.name}";
		}

		this.sectionListModel = { 
			fetchList: function(o) {
				//window.console.log("reture list");
				//return [];
				if (!self.sections) self.sections = [];
				return self.sections;
			} 
		}

		this.addItems = function() {
			if (!self.selectedItem) return;
			var handler = function( items ) {

			}

			var list = oboSvc.getSectionCategoryVariables({section: self.code.toUpperCase(), category: self.selectedItem.objid.toUpperCase()});

	        var params = {
	          callbackHandler: handler,
	          list: [],
	          permit: {},
	          values: {}
	        }

	        return new PopupOpener ("facilities", params, {width:500 , height: 400});
		}
	}
	\$put( "${PAGE.context}", controller, {
		"architectural": "/services/buildingpermit/buildingapplication/permits/architectural",
		"civil": "/services/buildingpermit/buildingapplication/permits/civil",
		"electrical": "/services/buildingpermit/buildingapplication/permits/electrical",
		"electronics": "/services/buildingpermit/buildingapplication/permits/electronics",
		"mechanical": "/services/buildingpermit/buildingapplication/permits/mechanical",
		"plumbing": "/services/buildingpermit/buildingapplication/permits/plumbing",
		"sanitary": "/services/buildingpermit/buildingapplication/permits/sanitary"
	})

	function goBack() {
    	window.history.back();
	}
</script>

<input type="button" value="Back" onclick="goBack()" class="btn btn-primary"/>
<input type="button" value="Print" class="btn btn-default" style="float:right"/>

<div class="container row" style="margin-top: 20px;">
	<div class="col-md-12">
		<p class="font16">Tracking No. : <label class="font16" r:context="${PAGE.context}" r:name="trackingno"/></p>
		<p class="font16">Owner : <label class="font16" r:context="${PAGE.context}" r:name="ctc.name" /></p>
		<!--
		<br>
		<p class="font16">Assign To : <label class="font16" r:context="${PAGE.context}" r:name="" /></p>
		-->
		<!--
		<ol r:context="${PAGE.context}" r:item="sections" r:varName="item">
			<li>#{item.title}</li>
		</ol>
		-->
	</div>
	<div class="col-md-12" style="margin:10px;">
		<table style="width: 100%;" r:context="${PAGE.context}" r:model="sectionListModel" r:varName="item" r:name="selectedItem">
			<tr>
				<td class="font16">
					#{item.title}
					<a r:context="${PAGE.context}" r:name="addItems">Add</a>
				</td>
			</tr>
		</table>
	</div>
</div>

<div r:controller="${PAGE.context}"></div>