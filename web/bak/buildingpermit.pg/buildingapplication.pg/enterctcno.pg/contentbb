 <%if( PARAMS.error !=null) { %>
<pre>Error ${PARAMS.error?.message}</pre>
<% } %>


<script>
\$register(  {id:"openertest", context: "opener-test", page: "/listlgu",options:{height:600} }  )

\$put("lgulist", 
   new function() {

    var svc = Service.lookup("CacheService", "default");

  this.lguid;
  this.lguname;
  this.orgid = '${PARAMS.name}';
  var self = this;
  this.showPopup = function() {
    var handler = function(p) {
      self.lguid = p.id;
      self.lguname = p.name;
      self._controller.refresh();
    }

    return new PopupOpener( "openertest", {callbackHandler: handler},{width:400 , height: 500} ); 
  }
  this.submit = function() {
    window.console.log( self.lguid );
      var elem = \$("#form1");
      if (elem != null) {
        var url = "/partners/${PARAMS.name}/services/buildingpermit/buildingapplication/record";
        if (self.lguid != null) url += "?lguid=" + self.lguid;
        window.console.log( url )
        elem.attr("action", url);
        //elem.submit();
      }
    }



       this.clearCache = function() {
        window.console.log("remove cache")

        var ctclist = ["123", "456", "321", "654"];
        var trackingno = "ONBP-2017-01-0001";
        var permitlist = ["architectural", "civil", "electrical", "electronics", "mechanical", "plumbing", "sanitary"];

        svc.removeCache( {key: trackingno} );
        //svc.put( [key: "${PARAMS.ctcno}_trackingno", value: TRACK_ID] );

        for (var i=0; i<ctclist.length; i++) {
          var c = ctclist[i];
          window.console.log( c );
          svc.removeCache({key: c});
          svc.removeCache({key: c + "_location"});
          svc.removeCache({key: c + "_bldgapp"});
          svc.removeCache({key: c + "_permits"});
          for (var j=0; j<permitlist.length; j++) {
            var p = permitlist[j];
            svc.removeCache({key: c + "_permit_" + p});
          }
        }
      }
   }
);  

\$(document).ready(function () {
      \$("input[name='radio']").click(function () {
        \$('#show-me').css('display', (\$(this).val() === '1') ? 'block':'none');

    });
       \$("input[name='radio']").click(function () {
        \$('#show-me1').css('display', (\$(this).val() === '2') ? 'block':'none');
    });
  }); 
</script>

<!-- <button r:context="lgulist" r:name="clearCache">Clear Cache</button> -->

    
    <h3>Enter Community Tax Certificate No. (CTC):</h3>
    <div class="row">
      <div class="col-md-4">

        <form id="form1" method="get" action="/partners/${PARAMS.name}/services/buildingpermit/buildingapplication/record" >
       
          <div class="input-group">
            <label>
              <input type="radio" checked="checked" name="radio" value="1"> Resident
            </label><br>
          </div>
          <div class="control-group" id='show-me' >
            <label class="control-label">CTC No.</label>
            <input type="text" name="ctcno" class="form-control"/>
          </div>

          <div class="input-group">
            <label><input type="radio" name="radio" value="2"> Non-resident</label>
          </div>
          <div class="control-group" id='show-me1' style='display:none'>
            <label class="control-label">CTC No.</label>
            <input type="text" name="ctcno2" r:required="true" class="form-control"/>
            <label class="control-label">Select LGU</label>
            <div class="input-group">
                <input type="text" r:context="lgulist" r:name="lguname" name="lguname" class="form-control"/>
                <span class="input-group-btn">
                  <input type="button" r:context="lgulist" r:name="showPopup" value="Select" class="btn btn-primary">
                </span>
              </div>
          </div>
          <div class="row" style="margin-top:30px;">
            <div class="col-md-4">
              <input class="thumbnail btn btn-primary" type="submit" value="Next" >
            </div>
          </div>
      </form>
    </div>
  </div>
          






  


 