<link href="/res/styles/style.css?ver=139" type="text/css" rel="stylesheet" />

<script type="text/javascript">
\$put("prop", new function(){
	var self = this;
	this.mode = "find-property";
	this.error;
	this.selectedItem;
	this.lots = [];
  this.tdno;
  this.selectedItem;
	this.td = {};
	this.lots = \$get("app").code.app.lots;

  this.findProperty = function() {
    var rptSvc = Service.lookup( '137:TDService' );
    var p = {refno: self.tdno };
    rptSvc.verifyTaxDec( p, function(o,s) {
      if( s == "error" ) {
        self.error = o.result;
      }
      else {
        console.log( o.result );
        self.td = o.result;
        self.error = null;    
        self.mode = "view-property";
      }
      self._controller.refresh(); 
    });
  }

  this.redoSearch = function() {
    this.td = {}
    self.mode = "find-property";
  }

  this.addProperty = function() {
    this.lots.push( this.td );
    this.td = {};
    self.mode = "view-all-properties";     
  }

	this.addLot = function(){
    //check if record was already added
    var i = 0;
    var added = false;
    for( i=0;i<self.lots.length;i++ ) {
      if( self.lots[i].tdno == self.td.tdno ) {
        self.error = "Lot is already added";
        added = true;
        break;
      }
    }
    if(!added) {
      self.lots.push(self.td);
    }
	}

	this.removeLot = function(){
		self.lots.remove(self.selectedItem);
	}


});
</script>
<br>
<br>
<legend>Project Site Details</legend>
<div r:context="prop" r:visibleWhen="#{error != null }">
	<label r:context="prop" style="color:red;">#{error}</label>
</div>

<br>
<br>
<div r:context="prop" r:visibleWhen="#{mode == 'find-property'}">
  <div class="row">
      <div class="col-md-4">
        <div class="control-group">
          <label class="control-label">Enter Tax Declaration of Property</label>
            <div class="form-group">
              <input type="text" class="form-control input-response" r:context="prop" r:name="tdno" r:textcase="none" >
              <input type="submit" r:context="prop" r:name="findProperty" class="btn btn-submit btn-primary" value="Search">              
            </div>
        </div>
      </div>      
    </div>
</div> 

<div r:context="prop" r:visibleWhen="#{mode == 'view-property'}">
  <label class="control-label">
    Please Verify first if the info is correct. If not correct please contact the assessor's office to verify. 
    Press Next to proceed</label>
    <dl class="dl-horizontal">
      <dt>Tax Dec No:</dt>
      <dd>: <label r:context="prop">#{td.tdno}</label></dd>

      <dt>TCT No </dt>
      <dd>: <label r:context="prop">#{td.tctno}</label></dd>

      <dt>Block No </dt>
      <dd>: <label r:context="prop">#{td.blockno}</label></dd>
      <dt>Lot No</dt>
      <dd>: <label r:context="prop">#{td.lotno}</label></dd>
      <dt>Street</dt>
      <dd>: <label r:context="prop">#{td.street}</label></dd>
      <dt>Barangay</dt>
      <dd>: <label r:context="prop">#{td.barangay.name}</label></dd>  
      <dt>Owner Name</dt>
      <dd>: <label r:context="prop">#{td.owner.name} (#{td.owner.entityno}) </label></dd>  

      <label r:context="prop" r:visibleWhen="#{td.isowned == true}">
      <dd>: Lot owned by project owner</dd>  
      </label>
      <br>
      <br>
      <input type="submit" r:context="prop" r:name="redoSearch" class="btn btn-submit btn-primary" value="Redo Search"> 
      <input type="submit" r:context="prop" r:name="addProperty" class="btn btn-submit btn-primary" value="Next">  
    </dl>
</div> 

<div  r:context="prop" r:visibleWhen="#{mode == 'view-all-properties'}">
  <label class="control-label">Lot information</label>
  <p>Please check if the following entries are correct.Click Next to proceed</p>
  <table r:context="prop" r:items="lots" r:varName="item" r:name="selectedItem" border="1px">
    <thead>
      <tr>
        <td>TD No</td>
        <td>TCT No</td>
        <td>Block No</td>
        <td>Lot No</td>
        <td>Street</td>
        <td>Barangay</td>
        <td>Owner</td>
        <td>Lot owned</td>
        <td>&nbsp;</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>#{item.tdno}</td>
        <td>#{item.tctno}</td>
        <td>#{item.blockno}</td>
        <td>#{item.lotno}</td>
        <td>#{item.street}</td>
        <td>#{item.barangay.name}</td>
        <td>#{item.owner.name} (#{item.owner.entityno})</td>
        <td><input type="checkbox" r:context="prop" r:name="item.isowned"/></td>
        <td><a href="#" r:context="prop" r:name="removeLot">Remove</a>  
      </tr>
    </tbody>
  </table>
  <br>
  <input type="submit" r:context="prop" r:name="redoSearch" class="btn btn-submit btn-primary" value="Add More Properties"> 
  <input type="submit" r:context="app" r:name="_professional" class="btn btn-submit btn-primary" value="Next">  

</div>


