import com.rameses.annotations.*; 
import java.rmi.server.*;

class BuildingPermitRequirementService {

	@DataContext("building_permit_requirement")
	def reqEm;

	@Env
	def env;

	@Service("DateService")
	def dateSvc;

	@ProxyMethod
	public def update( def o ) {
		o.reviewer = [objid: env.USERID, name: env.FULLNAME ];
		o.dtreviewed = dateSvc.getServerDate();
		if(o.previd ) {
			def z = reqEm.create(o);
			reqEm.find( [objid: o.previd] ).update( [supersederid: z.objid ] );
		}	
		else {
			reqEm.find( [objid: o.objid ] ).update( [state: o.state, remarks: o.remarks, reviewer: o.reviewer, dtreviewed: o.dtreviewed ] );
		}
		return o;
	}



}
