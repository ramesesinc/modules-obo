import com.rameses.annotations.*; 

class BuildingPermitPersistenceInterceptor {

	@DataContext("building_permit_issuance")
	def issuanceEm;

	@After(pattern="PersistenceService.create", eval="#{args[0]._schemaname == 'building_permit' && args[0].txnmode == 'CAPTURE' }")
	public void afterCreate(def evt) {
		def a = evt.args[0];
		def result = evt.result;
		def p = [:];
		p.permitno 
		p.appid = result.objid;
		p.controlno = a.permitno;
		p.dtissued = a.appdate;
		p.typeid = 'building_permit';
		p.txnmode = 'CAPTURE';
		issuanceEm.create( p );
	}


}