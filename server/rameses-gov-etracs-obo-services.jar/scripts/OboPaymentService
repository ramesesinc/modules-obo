import com.rameses.annotations.*; 

class OboPaymentService {

	@Service("NumberService")
	def numSvc;

	@DataContext("building_permit_fee")
	def feeEm;

	@DataContext("building_permit")
	def appEm;

	@Service("WorkflowTaskService")
	def wfSvc;

	@ProxyMethod
	public void postPayment( def o ) { 
		println "RECEIVING PAYMENT FOR " + o.refno;
		def app = appEm.find( [appno: o.refno ] ).first();
		feeEm.find([appid: app.objid]).update( [amtpaid: "{amount}"] );

		def m = [:];
		m.refid = app.objid;
		m.action = "post-payment";
		wfSvc.signal(m);
	}


}	