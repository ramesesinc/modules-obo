import com.rameses.annotations.*; 
import java.rmi.server.*;

class BuildingPermitFindingService {

	@DataContext("building_permit_finding")
	def findingEm;

	@Env
	def env;

	@Service("DateService")
	def dateSvc;

	@ProxyMethod
	public def create( def o ) { 
		if(o.objid) {
			findingEm.find( [objid: o.objid] ).update( o );
			return o;			
		}

		o.createdby = [objid: env.USERID, name: env.FULLNAME ];
		o.dtcreated = dateSvc.getServerDate();
		o.state = o.state;
		o.objid = "BLDGPMTFIND" + new UID();
		if( o.previd ) {
			def z = findingEm.create(o);
			findingEm.find( [objid: o.previd] ).update( [supersederid: z.objid ] );
		}
		else {
			o.rootid = o.objid;
			findingEm.create(o);
		}
		return o;
	}


}
