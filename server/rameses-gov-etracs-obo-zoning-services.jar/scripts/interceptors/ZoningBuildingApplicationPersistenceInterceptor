import com.rameses.annotations.*;
import java.rmi.server.*;

class ZoningBuildingApplicationPersistenceInterceptor {
	
	@DataContext("locational_clearance")
	def clearanceEm;

	@Env
	def env;

	@After(pattern="PersistenceService.read", eval="#{ args[0]._schemaname == 'vw_building_application' && result.task?.state.matches('releasing|end') }")
	public void afterOpenApplication(def evt) {
		def p = evt.args[0];
		def result = evt.result;

		def appid = result.objid;
		if( result.references == null ) result.references = [];

		def loc = clearanceEm.find( [appid: appid ]).first();
		if( loc ) {
			loc.title = "Locational Clearance";
			loc.refno = loc.controlno;
			result.references << loc;
		}
	}


}